<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,
  initial-scale=1, minimum-scale=1.0, shrink-to-fit=no">
  <link href="../figures/favicon-32x32.png" rel="icon" />
  <title>Adsorption ethanol crystal</title>
  <meta name="description" content="Osmosis tutorial">
  <meta name="author" content="Simon Gravelle">
  <link rel="stylesheet" type="text/css"
  href="../assets_tutorials/vendor/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css"
  href="../assets_tutorials/vendor/font-awesome/css/all.min.css" />
  <link rel="stylesheet" type="text/css"
  href="../assets_tutorials/css/stylesheet.css" />
  <script async
  src="https://www.googletagmanager.com/gtag/js?id=G-W1WGEC5GQ8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-W1WGEC5GQ8');
  </script>
  <script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body data-spy="scroll" data-target=".idocs-navigation" data-offset="125">
  <div id="main-wrapper">
    <!-- ======================================================= -->
    <!-- ======================================================= -->
    <!-- ======================================================= -->
    <header id="header" class="sticky-top">
      <nav class="primary-menu navbar navbar-expand-lg navbar-dropdown-dark">
        <div class="container-fluid">
          <a class="logo ml-md-3" href="../index.html" title="LAMMPS tutorials">
            <img src="../figures/logo.png"
            alt="LAMMPS tutorials" height="60"/>
          </a>
          <!--<button class="navbar-toggler ml-auto" type="button"
          data-toggle="collapse" data-target="#header-nav">
          <span></span>
          <span></span>
          <span></span>
          </button>-->
          <div id="header-nav" class="collapse navbar-collapse justify-content-end">
            <ul class="navbar-nav">
              <li class="dropdown"> <a class="dropdown-toggle" href="#">All tutorials</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item"
                    href="tutorial01.html">Tutorial 1</a>
                  </li>
                  <li><a class="dropdown-item"
                    href="tutorial02.html">Tutorial 2</a>
                  </li>
                  <li><a class="dropdown-item"
                    href="tutorial03.html">Tutorial 3</a>
                  </li>
                  <li><a class="dropdown-item"
                    href="tutorial04.html">Tutorial 4</a>
                  </li>
                  <li><a class="dropdown-item"
                    href="tutorial05.html">Tutorial 5</a>
                  </li>
                  <li><a class="dropdown-item"
                    href="tutorial06.html">Tutorial 6</a>
                  </li>
                </ul>
              </li>
              <li><a target="_blank"
                href="../miscellaneous/contact.html">Contact / Get help
                with your project</a>
              </li>
            </ul>
          </div>
          <ul class="social-icons social-icons-sm ml-lg-2 mr-2">
            <li class="social-icons-twitter"><a data-toggle="tooltip"
              href="https://twitter.com/GravelleSimon" target="_blank"
              title="" data-original-title="Twitter">
              <i class="fab fa-twitter"></i></a></li>
            <li class="social-icons-twitter"><a data-toggle="tooltip"
              href="https://gitlab.com/sgravelle" target="_blank"
              title="" data-original-title="Gitlab">
              <i class="fab fa-gitlab"></i></i></a></li>
            <li class="social-icons-twitter"><a data-toggle="tooltip"
              href="https://github.com/simongravelle" target="_blank"
              title="" data-original-title="Github">
              <i class="fab fa-github"></i></i></a></li>
            <li class="social-icons-twitter"><a data-toggle="tooltip"
              href="https://www.youtube.com/c/SimonGravelle"
              target="_blank" title="" data-original-title="Youtube">
              <i class="fab fa-youtube"></i></i></a></li>
          </ul>
        </div>
      </nav>
    </header>
<div class="idocs-navigation bg-light">
<ul class="nav flex-column ">
<li class="nav-item"><a class="nav-link active"
href="#intro">Getting Started</a>
</li>
<li class="nav-item"><a class="nav-link active"
href="#SystemCreation">System creation</a>
</li>
<li class="nav-item"><a class="nav-link active"
href="#Equilibrium">System equilibration</a>
</li>		
<li class="nav-item"><a class="nav-link active"
href="#Run">Production run</a>
</li>					
<li class="nav-item"><a class="nav-link"
href="#further">Going further</a>
</li>
</ul>
</div>
<div class="idocs-content">
<div class="container">
<section id="intro">
<h1>Osmosis flow through a porous membrane</h1>
<h3>Binary lennard-jones fluid flow through a rigid porous membrane</h3>
<br>
<p>
<img src="../figures/tutorial07/LAMMPS_system.png"
class="img-fluid" alt="Responsive image">
<small style="color:#6B6B6B">Figure: A fluid made of a solute (large yellow spheres
and solvent (small blue-ish spheres)) flowing though a porous membrane made of a 
single layer of atoms. The two gray layers on each sides are pistons ensuring that no evaporation
occurs.
</small>
</p>
<p>
<b>The objective of this tutorial</b> is to build a molecular
dynamics system made of a rigid porous membrane, two reservoirs containing
a solute and a solvent, and two pistons.
There are X main parts to this tutorial:
<ul>
<li> <a href="#SystemCreation">System creation- </a> First,
</li>
<li> <a href="#Equilibrium">System equilibration - </a>Then,
</li>
<li> <a href="#Run">Production run - </a>
Third,
</li>
</ul>
</p>
<p>If you are new to LAMMPS, I recommend you to follow
<a href="tutorial01.html">this simpler tutorial</a> first.
</p>
<p class="alert alert-info"> <a href="../miscellaneous/contact.html">Click here</a> if
you are looking for help with your project, if you want to support
me (for free or not), or if you have any suggestions for these tutorials.
</p>
</section>
<br><br>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
<section id="SystemCreation">
<h1>System creation</h1>
<br>
<p>Create a folder named SystemCreation, and within this folder, create a
LAMMPS input file called input.lammps.</p>
<br>
<h2>Simulation initialisation</h2>
<p>
Let us define some general parameters:
<pre><code>boundary	s p p
pair_style	lj/cut 2.5</code></pre></p>
<p> Here we impose that the boundary conditions along the \(x\), \(y\), and \(z\)
axis are non-periodic shrink-wrapped, periodic, and periodic, respectively. With
style "s", the position of the face is set so as to integrate the atoms in that 
dimension (shrink-wrapping), no matter how far they move. Then we set the pair style
as Lennard-Jones, with a cut-off.
<br><br>
Note that we did not set the units, atom_style, or dimension of the simulation, 
as is common to do, because we are using the default value of LAMMPS, 
respectively lj, atomic, and 3 (for 3D).
</p>
<br><br>
<h2>Region creation</h2>
<p>
The first step toward the creation of the system is to define regions of space.
The first region is a parallelepiped rectangle corresponding to the initial 
simulation box.
<br><br>
<img src="../figures/tutorial07/LAMMPS_box.png"
class="img-fluid" alt="Responsive image">
<br>
<small style="color:#6B6B6B">Figure: Molecular dynamics system simulation
box.</small>
<br>
</p>
<p>
Let us set the lattice to face-centered cubic (fcc) for the future positioning
of the solid wall atoms, define the simulation_box region, and use it to 
create the initial box:
<pre><code># ------------- System definition
lattice 	fcc 1
region		simulation_box block -50 50 -15 15 -15 15
create_box	5 simulation_box</code></pre></p>
<p>
The "5" in create_box indicates that the simulation will contain 5 types of 
atoms (solute, solvent, membrane, and pistons (x2)), see below. Then, let us
define 5 regions that will be use to place the atoms.
<br><br>
<img src="../figures/tutorial07/LAMMPS_regions.png"
class="img-fluid" alt="Responsive image">
<br>
<small style="color:#6B6B6B">Figure: Molecular dynamics system with all
five regions, from left to right : piston_left, fluid_left,
membrane, fluid_right, and piston_right.</small>

<pre><code>region		piston_left block -49 -48 INF INF INF INF
region		fluid_left block -45 -2 INF INF INF INF
region		membrane block -0.25 0.25 INF INF INF INF
region		fluid_right block 2 45 INF INF INF INF
region		piston_right block 48 49 INF INF INF INF</code></pre></p>
<p>
With the INF keyword, the region encompass the whole simulation box in that direction.
</p>
<br><br>
<h2>Place the atoms</h2>
<p>
The second step is to add the atoms within the system. 
<br><br>
<img src="../figures/tutorial07/LAMMPS_atoms.png"
class="img-fluid" alt="Responsive image">
<br>
<small style="color:#6B6B6B">Figure: Molecular dynamics system with all
five types of atoms: solid (types 1, 2 and 3) and fluid (types 4 and 5).</small>
<pre><code>create_atoms	1 region piston_left
create_atoms	2 region membrane
create_atoms	3 region piston_right
create_atoms	4 random 5000 654514 fluid_left
create_atoms	4 random 4500 654514 fluid_right
create_atoms	5 random 500 424514 fluid_right</code></pre></p>
<p>
Atoms of types 1, 2, and 3 are placed on the fcc lattice previously defined.
The atoms the fluid (types 4 and 5) are placed randomly. Solute (type 5) is placed
only on the right side of the membrane, so that the difference in osmotic pressure
will induce the flow of solvent.
</p>
<br><br>
<h2>Settings</h2>
<p>
Let us define the simulation settings. 
<pre><code># ------------- Simulation settings
mass		* 1
pair_coeff	1*4 1*4 1.0 1.0
pair_coeff	5 5 2.0 3.0</code></pre></p>
<p> The mass of all the atoms are set to 1 (unitless). The Lennard-Jones pair coefficient
between atoms of types 1 to 4 are set to 1 for both the depth of the potential 
well  \(\epsilon\) and the distance at which the particle-particle potential 
energy is zero \(\sigma\) (i.e. the size of the particle).  For the solute (type 5),
both \(\epsilon\) and \(\sigma\) are set to larger values, thus making the particles
of the solute effectively larger and more attractive. 
<br><br>
By default, the cross-parameters (i.e. between species \(i\) and \(j\)) are automatically calculated by LAMMPS.
Here, let us tune slightly these cross- parameters. First, let us
reduce slightly the affinity between the solvent and the walls (to reduce
unnecessarily large adsorption), and reduce even more the affinity between
the solute and the wall, and also increase the value of \(\sigma\):
<pre><code>pair_coeff	1*3 4 0.8 1
pair_coeff	1*3 5 0.1 3.0</code></pre></p>
<p>
The second line will help prevent the solute to cross the porous membrane too easily. 
</p>
<br><br>
<h2>Output and run</h2>
<p>
Let us dump the atom position for visualisation purpose,  
<pre><code># ------------- Output
dump		mydmp all atom 1 dump.lammpstrj
thermo		10</code></pre></p>
<p>
and finally minimise the energy of the system, and print the final position of
the atoms.
<pre><code># ------------- Run
minimize	1.0e-4 1.0e-6 1000 10000
write_data	data.lammps pair ij</code></pre></p>
<p> With the pair ij keyword, LAMMPS will print the simulation settings (mass and pair_coeff)
in the data.lammps file.
</p>
</section>
<br><br>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
<section id="Equilibrium">
<h1>System equilibration</h1>
<br>
<p>Create a second folder alongside the SystemCreation folder, and call it
Equilibrium. Create a new LAMMPS input file called input.lammps in it.</p>
<br>
<h2>Initialisation</h2>
<p>Start by re-writing the boundary and pair_style (these information
are not saved by the write_data command), and import write_data using 
the read_data command:
<pre><code>boundary	s p p
pair_style	lj/cut 2.5

read_data	../SystemCreation/data.lammps</code></pre>
</p>
<h2>Region and groups</h2>
<p>Let us define a region corresponding to the right side of the porous membrane,
which will be used later for recording which atoms are crossing the membrane.
<pre><code>region		right block 0 INF INF INF INF INF</code></pre></p>
<p>Then, let us group the atoms into groups, which will allow us to control them
more easily later:
<pre><code>group		solid type 1 2 3
group		piston_right type 3
group		membrane type 2
group		piston_left type 1
group		fluid type 4 5
group		solvent type 4
group		solute type 5</code></pre></p>
<h2>Small optimization</h2>
<p>Since we anticipate that the atoms of the solid will be frozen, we don't want 
LAMMPS to try to built neighbor list between the solid atoms. 
<pre><code>neigh_modify 	exclude group solid solid</code></pre></p>
<p>
This command will slightly speeds up the simulation, but won't influence the result. 
</p>
<h2>Dynamics</h2>
<p> Now, let us address the molecular dynamics of the atoms. First, let us 
give an initial temperature of 1 (unitless) to the atoms of the fluid:
<pre><code>velocity 	fluid create 1.0 4928459 mom yes rot yes dist gaussian</code></pre></p>
<p>Then, let us apply the fix nve to all the atoms in order to the molecular dynamics
(i.e. the update of the atom positions from the force calculation) to be 
performed:
<pre><code>fix		mynve all nve</code></pre></p>
<p>
Note that nve is applied to all atoms, even to solid atoms, even though they
will be maintained frozen (they will be maintained frozen thanks to setforce and addforce fixes, see below).
For the next step, let us control the temperature of the atoms of the fluid using a Langevin thermostat:
<pre><code>compute		temperature_fluid fluid temp
fix		mylgv fluid langevin 1.0 1.0 0.1 1530917 zero yes
fix_modify	mylgv temp temperature_fluid</code></pre></p>
<p>
The fix_modify, which uses the temperature calculated by the compute temperature_fluid,
ensures that the temperature of the fluid is used as a reference temperature. 
<br><br>
Then, let us force the membrane to remain frozen by canceling the force 
applied on the atoms of the membrane at every timestep:
<pre><code>fix		mysf1 membrane setforce 0 0 0</code></pre></p>
<p>
In addition, we want to freeze the piston, but still allow them to move as 
rigid bodies along the \(x\) direction. To do so, let us combine the 
setforce and aveforce commands. 
<pre><code>fix		mysf2 piston_left setforce NULL 0 0
fix		mysf3 piston_right setforce NULL 0 0
variable	F equal 0.01
fix		myaf1 piston_left aveforce ${F} NULL NULL
fix		myaf2 piston_right aveforce -${F} NULL NULL</code></pre></p>
<p>
A force \(F\) is applied on the atoms of the piston along \(x\) is order to 
slightly compress the fluid.
</p>
<h2>Outputs</h2>
<p>In order to make sure that the dynamics is working fine, let us print out 
a few information, such as the piston position and number of fluid atoms in the 
right reservoir:
<pre><code># ------------- Output
variable	solvent_right equal count(solvent,right)
variable	solute_right equal count(solute,right)
variable	position_piston_left equal xcm(piston_left,x)
variable	position_piston_right equal xcm(piston_right,x)

fix		myat1 all ave/time 1000 1 1000 v_solvent_right file solvent_right.dat
fix		myat2 all ave/time 1000 1 1000 v_solute_right file solute_right.dat
fix		myat3 all ave/time 1000 1 1000 v_position_piston_left file position_piston_left.dat
fix		myat4 all ave/time 1000 1 1000 v_position_piston_right file position_piston_right.dat

dump		mydmp all atom 1000 dump.lammpstrj
thermo_modify	temp temperature_fluid</code></pre></p>
<p>
</p>
<h2>Run</h2>
<p>Finally, let us run the equilibration for 1 million timesteps and save the final state
of the simulation:
<pre><code># ------------- Run
run		1000000

write_data	data.lammps pair ij</code></pre></p>
<p>

</p>
</section>
<br><br>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
<section id="Run">
<h1>Production run</h1>
<br>
<p>Create a thidr folder alongside the two current folders, and call it
Porosity0.5. Create a new LAMMPS input file called input.lammps in it.</p>
<br>
<h2>Initialisation and membrane drilling</h2>
<p>Let us start by copy-pasting similar commands as previously:
<pre><code># LAMMPS input script

boundary	s p p
pair_style	lj/cut 2.5

read_data	../Equilibrium/data.lammps

region		right block 0 INF INF INF INF INF

group		solid type 1 2 3
group		piston_right type 3
group		membrane type 2
group		piston_left type 1
group		fluid type 4 5
group		solvent type 4
group		solute type 5

neigh_modify 	exclude group solid solid</code></pre></p>
<p>
Then, let us delete randomly \(50\%\) of the atoms of the membrane:
<pre><code>region		membrane block -0.25 0.25 INF INF INF INF
delete_atoms 	porosity membrane 0.5 482793</code></pre></p>
<p> This command deletes \(50\%\) of the atoms of the membrane region. The last
number is a seed, change its value to generate different pattern, and different
porosity can be obtained by changing the fraction of deleted atoms:
<img src="../figures/tutorial07/membranes.png"
class="img-fluid" alt="Responsive image">
<br>
<small style="color:#6B6B6B">Figure: Membranes with different degree of deleted atoms
</small>
</p>
<h2>Dynamics and data printing</h2>
<p>
Finally, let us re-enter the dynamics setting used in the equilibration step, and 
print information into data file:
<pre><code>fix		mynve all nve
compute		temperature_fluid fluid temp
fix		mylgv fluid langevin 1.0 1.0 0.1 1530917 zero yes
fix_modify	mylgv temp temperature_fluid
thermo_modify	temp temperature_fluid

fix		mysf1 membrane setforce 0 0 0
fix		mysf2 piston_left setforce NULL 0 0
fix		mysf3 piston_right setforce NULL 0 0

variable	F equal 0.01
fix		myaf1 piston_left aveforce ${F} NULL NULL
fix		myaf2 piston_right aveforce -${F} NULL NULL

variable	solvent_right equal count(solvent,right)
variable	solute_right equal count(solute,right)
variable	position_piston_left equal xcm(piston_left,x)
variable	position_piston_right equal xcm(piston_right,x)

fix		myat1 all ave/time 10000 1 10000 v_solvent_right file solvent_right.dat
fix		myat2 all ave/time 10000 1 10000 v_solute_right file solute_right.dat
fix		myat3 all ave/time 10000 1 10000 v_position_piston_left file position_piston_left.dat
fix		myat4 all ave/time 10000 1 10000 v_position_piston_right file position_piston_right.dat
fix		myat5 all ave/time 10 1000 10000 f_mysf1[1] file force_membrane.dat

dump		mydmp all atom 10000 dump.lammpstrj

thermo		10000
run		100000000</code></pre></p>

<p> Here I plot the number of solvent atoms in the right reservoir as a function
of time for different membrane porosity:

<img src="../figures/tutorial07/solvent_left.png"
class="img-fluid" alt="Responsive image">
<br>
<small style="color:#6B6B6B">Figure: Number of solvent atoms in the right reservoir as a 
function of time.
</small>

<br><br><br>
Looking at the solute as a function of time give hint on whether the membrane is
semi-permeable or not:
<br>


<img src="../figures/tutorial07/solute_left.png"
class="img-fluid" alt="Responsive image">
<br>
<small style="color:#6B6B6B">Figure: Number of solute atoms in the right reservoir as a 
function of time.
</small>

</p>



</section>
<br><br>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
<section id="further">
<h2>Going further</h2>
<p>
</p>
</p>
</section>
	      </div>
	    </div>
			<footer id="footer" class="section">
				<div class="container">
					<p class="text-2 text-center mb-0">This template has been adapted from
						<a class="btn-link" target="_blank"
						href="https://github.com/harnishdesign/iDocs/">HarnishDesign</a>.
					</p>
				</div>
			</footer>
		</div>
		<a id="back-to-top" data-toggle="tooltip"
    title="Back to Top" href="javascript:void(0)"><i class="fa fa-chevron-up"></i></a>
		<script src="../assets_tutorials/vendor/jquery/jquery.min.js"></script>
		<script src="../assets_tutorials/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script src="../assets_tutorials/vendor/highlight.js/highlight.min.js"></script>
		<script src="../assets_tutorials/vendor/jquery.easing/jquery.easing.min.js"></script>
		<script src="../assets_tutorials/vendor/magnific-popup/jquery.magnific-popup.min.js"></script>
		<script src="../assets_tutorials/js/theme.js"></script>
	</body>
</html>
